import { useState } from 'react';
import type { FlashCard, Translation } from '@/types/learning';

interface FlashcardProps {
  flashcard: FlashCard;
  translation: Translation;
  onResult: (result: 'easy' | 'medium' | 'hard') => void;
}

export default function Flashcard({ flashcard, translation, onResult }: FlashcardProps) {
  const [isFlipped, setIsFlipped] = useState(false);
  const [isAnswered, setIsAnswered] = useState(false);

  // Fun facts: one per language/country, now with Hindi
  const exampleSentences: Record<string, {
    source: string;
    target: { es: string; fr: string; de: string; it: string; pt: string; ru: string; hi: string };
    emoji?: string;
    funFact: { es: string; fr: string; de: string; it: string; pt: string; ru: string; hi: string };
  }> = {
    'Hello': {
      source: 'Hello! How are you?',
      target: {
        es: '¬°Hola! ¬øC√≥mo est√°s?',
        fr: 'Bonjour! Comment √ßa va?',
        de: 'Hallo! Wie geht es dir?',
        it: 'Ciao! Come stai?',
        pt: 'Ol√°! Como vai voc√™?',
        ru: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?',
        hi: '‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§ï‡•à‡§∏‡•á ‡§π‡•ã?'
      },
      emoji: 'üëã',
      funFact: {
        es: 'In Spain, people often greet with two kisses on the cheek.',
        fr: 'In France, people greet with la bise (a kiss on each cheek).',
        de: 'In Germany, a handshake is common as a greeting.',
        it: 'In Italy, people greet with two kisses on the cheek, starting on the right.',
        pt: 'In Portugal, people greet with two kisses on the cheek, often starting on the left.',
        ru: 'In Russia, a firm handshake is common, but close friends may hug.',
        hi: 'In India, people greet with "Namaste" by joining their palms.'
      }
    },
    'Thank you': {
      source: 'Thank you for your help.',
      target: {
        es: 'Gracias por tu ayuda.',
        fr: 'Merci pour votre aide.',
        de: 'Danke f√ºr deine Hilfe.',
        it: 'Grazie per il tuo aiuto.',
        pt: 'Obrigado pela sua ajuda.',
        ru: '–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à—É –ø–æ–º–æ—â—å.',
        hi: '‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶‡•§'
      },
      emoji: 'üôè',
      funFact: {
        es: 'In Spain, saying "gracias" is key to politeness.',
        fr: 'In France, "merci" is essential for good manners.',
        de: 'In Germany, "danke" is one of the most important words.',
        it: 'In Italy, "grazie" is used frequently and warmly.',
        pt: 'In Portugal, "obrigado" (if you are male) or "obrigada" (if you are female) is used.',
        ru: 'In Russia, "spasibo" (—Å–ø–∞—Å–∏–±–æ) is the standard way to say thank you.',
        hi: 'In India, "dhanyavaad" (‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶) is a formal way to say thank you.'
      }
    },
    'Dog': {
      source: 'The dog is friendly.',
      target: {
        es: 'El perro es amigable.',
        fr: 'Le chien est amical.',
        de: 'Der Hund ist freundlich.',
        it: 'Il cane √® amichevole.',
        pt: 'O c√£o √© amig√°vel.',
        ru: '–°–æ–±–∞–∫–∞ –¥—Ä—É–∂–µ–ª—é–±–Ω–∞—è.',
        hi: '‡§ï‡•Å‡§§‡•ç‡§§‡§æ ‡§¶‡•ã‡§∏‡•ç‡§§‡§æ‡§®‡§æ ‡§π‡•à‡•§'
      },
      emoji: 'üê∂',
      funFact: {
        es: 'Dogs are the most popular pets in Spain.',
        fr: 'Dogs are the most popular pets in France.',
        de: 'Dogs are the most popular pets in Germany.',
        it: 'Dogs are beloved pets in Italy, especially small breeds.',
        pt: 'Dogs are common pets in Portugal.',
        ru: 'Dogs are popular pets in Russia, especially in rural areas.',
        hi: 'Dogs are popular pets in India and are considered loyal companions.'
      }
    },
    'Apple': {
      source: 'I eat an apple every day.',
      target: {
        es: 'Como una manzana cada d√≠a.',
        fr: 'Je mange une pomme chaque jour.',
        de: 'Ich esse jeden Tag einen Apfel.',
        it: 'Mangio una mela ogni giorno.',
        pt: 'Como uma ma√ß√£ todos os dias.',
        ru: '–Ø –µ–º —è–±–ª–æ–∫–æ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.',
        hi: '‡§Æ‡•à‡§Ç ‡§∞‡•ã‡§ú‡§º ‡§è‡§ï ‡§∏‡•á‡§¨ ‡§ñ‡§æ‡§§‡§æ ‡§π‡•Ç‡§Å‡•§'
      },
      emoji: 'üçè',
      funFact: {
        es: 'Apples are a symbol of knowledge in Spanish culture.',
        fr: 'Apples are a classic fruit in French snacks.',
        de: 'Apples are a staple in German desserts.',
        it: 'In Italy, apples are grown mainly in the north.',
        pt: 'Portugal has many varieties of apples, especially in the west.',
        ru: 'In Russia, apples are often used for homemade jams.',
        hi: 'Apples are grown in abundance in the Indian state of Himachal Pradesh.'
      }
    },
    'Good night': {
      source: 'Good night and sweet dreams!',
      target: {
        es: '¬°Buenas noches y dulces sue√±os!',
        fr: 'Bonne nuit et fais de beaux r√™ves!',
        de: 'Gute Nacht und s√º√üe Tr√§ume!',
        it: 'Buona notte e sogni d‚Äôoro!',
        pt: 'Boa noite e bons sonhos!',
        ru: '–°–ø–æ–∫–æ–π–Ω–æ–π –Ω–æ—á–∏ –∏ —Å–ª–∞–¥–∫–∏—Ö —Å–Ω–æ–≤!',
        hi: '‡§∂‡•Å‡§≠ ‡§∞‡§æ‡§§‡•ç‡§∞‡§ø ‡§î‡§∞ ‡§Æ‡•Ä‡§†‡•á ‡§∏‡§™‡§®‡•á!'
      },
      emoji: 'üåô',
      funFact: {
        es: 'It‚Äôs polite to wish "buenas noches" in Spain.',
        fr: 'In France, people say "bonne nuit" before bed.',
        de: 'In Germany, people say "Gute Nacht" before sleeping.',
        it: 'In Italy, "buona notte" is said before going to bed.',
        pt: 'In Portugal, "boa noite" is a warm wish before sleep.',
        ru: 'In Russia, "spokoynoy nochi" (–°–ø–æ–∫–æ–π–Ω–æ–π –Ω–æ—á–∏) is said before bed.',
        hi: 'In India, people often say "Shubh Raatri" (‡§∂‡•Å‡§≠ ‡§∞‡§æ‡§§‡•ç‡§∞‡§ø) before sleeping.'
      }
    },
    'Friend': {
      source: 'My friend is coming over.',
      target: {
        es: 'Mi amigo viene a casa.',
        fr: 'Mon ami vient chez moi.',
        de: 'Mein Freund kommt vorbei.',
        it: 'Il mio amico viene a casa.',
        pt: 'Meu amigo vem aqui.',
        ru: '–ú–æ–π –¥—Ä—É–≥ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –≥–æ—Å—Ç–∏.',
        hi: '‡§Æ‡•á‡§∞‡§æ ‡§¶‡•ã‡§∏‡•ç‡§§ ‡§ò‡§∞ ‡§Ü ‡§∞‡§π‡§æ ‡§π‡•à‡•§'
      },
      emoji: 'ü§ù',
      funFact: {
        es: 'In Spanish, ‚Äúamigo‚Äù is for males and ‚Äúamiga‚Äù for females.',
        fr: 'In French, "ami" is masculine and "amie" is feminine.',
        de: 'In German, "Freund" is for males and "Freundin" for females.',
        it: 'In Italian, "amico" is masculine and "amica" is feminine.',
        pt: 'In Portuguese, "amigo" is masculine and "amiga" is feminine.',
        ru: 'In Russian, "drug" (–¥—Ä—É–≥) is for a friend, regardless of gender.',
        hi: 'In Hindi, "‡§¶‡•ã‡§∏‡•ç‡§§" (dost) is a gender-neutral word for friend.'
      }
    },
    'School': {
      source: 'School starts at 8 AM.',
      target: {
        es: 'La escuela empieza a las 8 AM.',
        fr: 'L‚Äô√©cole commence √† 8h.',
        de: 'Die Schule beginnt um 8 Uhr.',
        it: 'La scuola inizia alle 8.',
        pt: 'A escola come√ßa √†s 8h.',
        ru: '–®–∫–æ–ª–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ 8 —É—Ç—Ä–∞.',
        hi: '‡§∏‡•ç‡§ï‡•Ç‡§≤ 8 ‡§¨‡§ú‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à‡•§'
      },
      emoji: 'üè´',
      funFact: {
        es: 'In Spain, uniforms are common in private schools.',
        fr: 'Most French schools do not require uniforms.',
        de: 'Most German schools do not require uniforms.',
        it: 'In Italy, some schools require a white smock for young children.',
        pt: 'In Portugal, uniforms are rare except in private schools.',
        ru: 'In Russia, school uniforms are making a comeback in many regions.',
        hi: 'In India, most schools require students to wear uniforms.'
      }
    },
    'Book': {
      source: 'This book is interesting.',
      target: {
        es: 'Este libro es interesante.',
        fr: 'Ce livre est int√©ressant.',
        de: 'Dieses Buch ist interessant.',
        it: 'Questo libro √® interessante.',
        pt: 'Este livro √© interessante.',
        ru: '–≠—Ç–∞ –∫–Ω–∏–≥–∞ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è.',
        hi: '‡§Ø‡§π ‡§ï‡§ø‡§§‡§æ‡§¨ ‡§¶‡§ø‡§≤‡§ö‡§∏‡•ç‡§™ ‡§π‡•à‡•§'
      },
      emoji: 'üìö',
      funFact: {
        es: 'The word for book in Spanish is "libro".',
        fr: 'The word for book in French is "livre".',
        de: 'The word for book in German is "Buch".',
        it: 'The word for book in Italian is "libro".',
        pt: 'The word for book in Portuguese is "livro".',
        ru: 'The word for book in Russian is "kniga" (–∫–Ω–∏–≥–∞).',
        hi: 'The word for book in Hindi is "‡§ï‡§ø‡§§‡§æ‡§¨" (kitaab).'
      }
    },
    'Water': {
      source: 'Can I have some water?',
      target: {
        es: '¬øPuedo tomar agua?',
        fr: 'Puis-je avoir de l‚Äôeau ?',
        de: 'Kann ich etwas Wasser haben?',
        it: 'Posso avere dell‚Äôacqua?',
        pt: 'Posso beber √°gua?',
        ru: '–ú–æ–∂–Ω–æ –º–Ω–µ –≤–æ–¥—ã?',
        hi: '‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡•Å‡§ù‡•á ‡§•‡•ã‡§°‡§º‡§æ ‡§™‡§æ‡§®‡•Ä ‡§Æ‡§ø‡§≤ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à?'
      },
      emoji: 'üíß',
      funFact: {
        es: 'In Spanish, "agua" is feminine but uses "el" in singular.',
        fr: 'In French, "eau" is a feminine word.',
        de: 'In German, "Wasser" is a neutral word.',
        it: 'In Italian, "acqua" is feminine.',
        pt: 'In Portuguese, "√°gua" is feminine.',
        ru: 'In Russian, "voda" (–≤–æ–¥–∞) is feminine.',
        hi: 'In Hindi, "‡§™‡§æ‡§®‡•Ä" (paani) is masculine.'
      }
    },
    'Family': {
      source: 'Family is important.',
      target: {
        es: 'La familia es importante.',
        fr: 'La famille est importante.',
        de: 'Familie ist wichtig.',
        it: 'La famiglia √® importante.',
        pt: 'A fam√≠lia √© importante.',
        ru: '–°–µ–º—å—è –≤–∞–∂–Ω–∞.',
        hi: '‡§™‡§∞‡§ø‡§µ‡§æ‡§∞ ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§π‡•à‡•§'
      },
      emoji: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
      funFact: {
        es: 'Family gatherings are important in Spanish culture.',
        fr: 'Family is very important in French culture.',
        de: 'Family get-togethers are popular in Germany.',
        it: 'In Italy, Sunday lunch with family is a cherished tradition.',
        pt: 'Family is the foundation of Portuguese society.',
        ru: 'In Russia, family ties are highly valued.',
        hi: 'In India, joint families are common and highly valued.'
      }
    },
  };

  const handleFlip = () => {
    if (!isAnswered) {
      setIsFlipped(!isFlipped);
    }
  };

  const handleDifficulty = (difficulty: 'easy' | 'medium' | 'hard') => {
    setIsAnswered(true);
    onResult(difficulty);
  };

  // Accept targetLang as a prop for dynamic fun facts
  const { targetLang = 'es' } = translation;
  type SupportedLang = 'es' | 'fr' | 'de' | 'it' | 'pt' | 'ru' | 'hi';
  const safeLang: SupportedLang = ['es', 'fr', 'de', 'it', 'pt', 'ru', 'hi'].includes(targetLang) ? targetLang as SupportedLang : 'es';
  const example = exampleSentences[translation.sourceText];

  return (
    <div className="max-w-xs w-full min-w-[16rem] mx-auto my-6">
      <div
        className={`relative h-80 w-full cursor-pointer perspective-1000 transform-style-3d transition-transform duration-500 ${
          isFlipped ? 'rotate-y-180' : ''
        }`}
        onClick={handleFlip}
        style={{ boxShadow: '0 8px 24px rgba(0,0,0,0.14)', borderRadius: '1.5rem', background: 'var(--card-bg, linear-gradient(135deg, #f8fafc 60%, #dbeafe 100%))' }}
      >
        {/* Front of card */}
        <div className={`absolute w-full h-full flex flex-col items-center justify-center p-8 backface-hidden rounded-3xl border-2 border-blue-200 dark:border-blue-800 bg-white dark:bg-gray-900 ${isFlipped ? 'hidden' : ''}`}
          style={{ boxShadow: '0 2px 12px rgba(30,64,175,0.08)' }}>
          <span className="text-5xl mb-4">{example?.emoji}</span>
          <h3 className="text-3xl font-bold mb-2 text-blue-700 dark:text-blue-300">{translation.sourceText}</h3>
          <p className="text-gray-600 dark:text-gray-400 italic">Tap to see the answer</p>
        </div>

        {/* Back of card */}
        <div className={`absolute w-full h-full flex flex-col items-center justify-center p-8 backface-hidden rotate-y-180 rounded-3xl border-2 border-blue-200 dark:border-blue-800 bg-white dark:bg-gray-900 ${isFlipped ? '' : 'hidden'}`}
          style={{ boxShadow: '0 2px 12px rgba(30,64,175,0.08)' }}>
          <span className="text-5xl mb-4">{example?.emoji}</span>
          {/* Show the translation of the word at the top */}
          <h3 className="text-3xl font-bold mb-2 text-green-700 dark:text-green-300">{translation.targetText}</h3>
          {example && (
            <>
              <div className="mb-2 text-center">
                <span className="block text-base text-gray-700 dark:text-gray-300 italic">{example.source}</span>
                {/* Show the example sentence in the selected language below */}
                {example.target && (
                  <span className="block text-base text-gray-700 dark:text-gray-300 italic">{example.target[safeLang]}</span>
                )}
              </div>
              {example.funFact && (
                <div className="mb-2 text-xs text-blue-500 dark:text-blue-300">{example.funFact[safeLang]}</div>
              )}
            </>
          )}
        </div>
      </div>
    </div>
  );
}
